<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éšæœºå›¾ç‰‡å±•ç¤º</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .container {
            width: 100%;
            max-width: 1000px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        
        #image-container {
            width: 100%;
            height: 500px;
            margin: 20px 0;
            border: 2px dashed #ddd;
            border-radius: 10px;
            overflow: hidden;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        #random-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: opacity 0.3s ease;
        }
        
        .loading {
            font-size: 18px;
            color: #7f8c8d;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }
        
        button {
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #random-btn {
            background-color: #3498db;
            color: white;
        }
        
        #random-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        #prev-btn {
            background-color: #95a5a6;
            color: white;
        }
        
        #prev-btn:hover {
            background-color: #7f8c8d;
        }
        
        .info-panel {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .info-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .info-value {
            color: #3498db;
        }
        
        .file-list {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #f8f9fa;
        }
        
        .file-item {
            padding: 8px;
            margin: 5px 0;
            background-color: white;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            #image-container {
                height: 400px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ éšæœºå›¾ç‰‡å±•ç¤ºå™¨</h1>
        <div class="subtitle">ç‚¹å‡»æŒ‰é’®éšæœºæ˜¾ç¤ºGitHubä»“åº“ä¸­çš„å›¾ç‰‡</div>
        
        <div id="image-container">
            <div class="loading">æ­£åœ¨åŠ è½½å›¾ç‰‡...</div>
            <img id="random-image" src="" alt="éšæœºå›¾ç‰‡" style="display: none;">
        </div>
        
        <div class="controls">
            <button id="prev-btn" title="ä¸Šä¸€å¼ ">
                <span>â†</span> ä¸Šä¸€å¼ 
            </button>
            <button id="random-btn" title="éšæœºä¸€å¼ ">
                <span>ğŸ²</span> éšæœºä¸€å¼ 
            </button>
        </div>
        
        <div class="info-panel">
            <div class="info-item">
                <span class="info-label">å½“å‰å›¾ç‰‡ï¼š</span>
                <span id="current-filename" class="info-value">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">å›¾ç‰‡åºå·ï¼š</span>
                <span id="current-index" class="info-value">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">æ€»å›¾ç‰‡æ•°ï¼š</span>
                <span id="total-count" class="info-value">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">æœ€åæ›´æ–°ï¼š</span>
                <span id="last-updated" class="info-value">-</span>
            </div>
        </div>
        
        <div id="file-list-container" style="display: none;">
            <h3>ğŸ“ æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶</h3>
            <div class="file-list" id="file-list"></div>
        </div>
    </div>

    <script>
        // ========== é…ç½®åŒºåŸŸ ==========
        const CONFIG = {
            // ä¿®æ”¹ä»¥ä¸‹ä¿¡æ¯ä¸ºä½ çš„GitHubä¿¡æ¯
            GITHUB_USERNAME: 'RuangCole',      // ä½ çš„GitHubç”¨æˆ·å
            REPOSITORY_NAME: 'scenery',     // ä½ çš„ä»“åº“å
            IMAGE_FOLDER: 'image',               // å›¾ç‰‡æ–‡ä»¶å¤¹å
            BRANCH: 'main',                       // åˆ†æ”¯åï¼Œé»˜è®¤main
            
            // å¯é€‰ï¼šè®¾ç½®æ”¯æŒçš„å›¾ç‰‡æ ¼å¼
            ALLOWED_EXTENSIONS: ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'],
            
            // å¯é€‰ï¼šè®¾ç½®ç¼“å­˜æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
            CACHE_DURATION: 5 * 60 * 1000, // 5åˆ†é’Ÿ
        };
        // ========== é…ç½®ç»“æŸ ==========

        // çŠ¶æ€ç®¡ç†
        let state = {
            imageList: [],           // æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶åæ•°ç»„
            currentIndex: -1,        // å½“å‰æ˜¾ç¤ºçš„å›¾ç‰‡ç´¢å¼•
            previousIndex: -1,       // ä¸Šä¸€å¼ å›¾ç‰‡ç´¢å¼•
            isLoading: false,        // åŠ è½½çŠ¶æ€
            lastUpdateTime: null,    // æœ€åæ›´æ–°æ—¶é—´
            history: []              // æµè§ˆå†å²
        };

        // DOMå…ƒç´ 
        const elements = {
            image: document.getElementById('random-image'),
            container: document.getElementById('image-container'),
            loading: document.querySelector('.loading'),
            randomBtn: document.getElementById('random-btn'),
            prevBtn: document.getElementById('prev-btn'),
            currentFilename: document.getElementById('current-filename'),
            currentIndex: document.getElementById('current-index'),
            totalCount: document.getElementById('total-count'),
            lastUpdated: document.getElementById('last-updated'),
            fileList: document.getElementById('file-list'),
            fileListContainer: document.getElementById('file-list-container')
        };

        // åˆå§‹åŒ–
        async function init() {
            showLoading(true);
            try {
                // ä»GitHub APIè·å–å›¾ç‰‡åˆ—è¡¨
                await fetchImageList();
                
                if (state.imageList.length > 0) {
                    // æ˜¾ç¤ºç¬¬ä¸€å¼ éšæœºå›¾ç‰‡
                    showRandomImage();
                    
                    // æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
                    displayFileList();
                    
                    updateInfoPanel();
                } else {
                    showError('æœªæ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥é…ç½®');
                }
            } catch (error) {
                showError('åˆå§‹åŒ–å¤±è´¥ï¼š' + error.message);
            } finally {
                showLoading(false);
            }
            
            // ç»‘å®šäº‹ä»¶
            setupEventListeners();
        }

        // ä»GitHub APIè·å–å›¾ç‰‡åˆ—è¡¨
        async function fetchImageList() {
            try {
                const apiUrl = `https://api.github.com/repos/${CONFIG.GITHUB_USERNAME}/${CONFIG.REPOSITORY_NAME}/contents/${CONFIG.IMAGE_FOLDER}?ref=${CONFIG.BRANCH}`;
                
                console.log('æ­£åœ¨ä»GitHubè·å–å›¾ç‰‡åˆ—è¡¨...');
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`GitHub APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const files = await response.json();
                
                // è¿‡æ»¤å‡ºå›¾ç‰‡æ–‡ä»¶
                state.imageList = files
                    .filter(file => !file.name.startsWith('.')) // æ’é™¤éšè—æ–‡ä»¶
                    .filter(file => CONFIG.ALLOWED_EXTENSIONS.some(ext => 
                        file.name.toLowerCase().endsWith('.' + ext)
                    ))
                    .map(file => ({
                        name: file.name,
                        url: file.download_url,
                        size: file.size,
                        path: file.path
                    }));
                
                state.lastUpdateTime = new Date();
                
                console.log(`æ‰¾åˆ° ${state.imageList.length} å¼ å›¾ç‰‡`);
                
            } catch (error) {
                console.error('è·å–å›¾ç‰‡åˆ—è¡¨å¤±è´¥:', error);
                
                // å¤‡ç”¨æ–¹æ¡ˆï¼šå¦‚æœAPIå¤±è´¥ï¼Œå°è¯•ç›´æ¥æ„å»ºURLï¼ˆéœ€è¦çŸ¥é“å›¾ç‰‡å‘½åè§„åˆ™ï¼‰
                // ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å¤‡ç”¨é€»è¾‘
                throw error;
            }
        }

        // æ˜¾ç¤ºéšæœºå›¾ç‰‡
        function showRandomImage() {
            if (state.imageList.length === 0) return;
            
            // ç”Ÿæˆéšæœºç´¢å¼•ï¼ˆç¡®ä¿ä¸é‡å¤è¿ç»­æ˜¾ç¤ºåŒä¸€å¼ ï¼‰
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * state.imageList.length);
            } while (randomIndex === state.currentIndex && state.imageList.length > 1);
            
            showImageByIndex(randomIndex);
        }

        // æ˜¾ç¤ºä¸Šä¸€å¼ å›¾ç‰‡
        function showPreviousImage() {
            if (state.history.length < 2) return;
            
            // ç§»é™¤å½“å‰å›¾ç‰‡
            state.history.pop();
            // è·å–ä¸Šä¸€å¼ å›¾ç‰‡
            const previousIndex = state.history[state.history.length - 1];
            
            if (previousIndex !== undefined) {
                showImageByIndex(previousIndex, false);
            }
        }

        // æ˜¾ç¤ºæŒ‡å®šç´¢å¼•çš„å›¾ç‰‡
        function showImageByIndex(index, addToHistory = true) {
            if (index < 0 || index >= state.imageList.length) return;
            
            state.previousIndex = state.currentIndex;
            state.currentIndex = index;
            
            if (addToHistory) {
                state.history.push(index);
                // é™åˆ¶å†å²è®°å½•é•¿åº¦
                if (state.history.length > 20) {
                    state.history.shift();
                }
            }
            
            const imageData = state.imageList[index];
            
            showLoading(true);
            
            // é¢„åŠ è½½å›¾ç‰‡
            const img = new Image();
            img.onload = function() {
                elements.image.src = imageData.url;
                elements.image.style.display = 'block';
                elements.loading.style.display = 'none';
                
                updateInfoPanel();
                updateButtonStates();
                
                // æ·»åŠ åŠ è½½å®ŒæˆåŠ¨ç”»
                elements.image.style.opacity = '0';
                setTimeout(() => {
                    elements.image.style.transition = 'opacity 0.5s ease';
                    elements.image.style.opacity = '1';
                }, 10);
                
                showLoading(false);
            };
            
            img.onerror = function() {
                showError(`å›¾ç‰‡åŠ è½½å¤±è´¥: ${imageData.name}`);
                showLoading(false);
            };
            
            img.src = imageData.url;
        }

        // æ›´æ–°ä¿¡æ¯é¢æ¿
        function updateInfoPanel() {
            if (state.currentIndex >= 0 && state.imageList[state.currentIndex]) {
                const currentImage = state.imageList[state.currentIndex];
                
                elements.currentFilename.textContent = currentImage.name;
                elements.currentIndex.textContent = `${state.currentIndex + 1} / ${state.imageList.length}`;
                elements.totalCount.textContent = state.imageList.length;
                
                if (state.lastUpdateTime) {
                    elements.lastUpdated.textContent = state.lastUpdateTime.toLocaleTimeString();
                }
            }
        }

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtonStates() {
            elements.prevBtn.disabled = state.history.length < 2;
        }

        // æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨
        function displayFileList() {
            if (state.imageList.length === 0) return;
            
            elements.fileList.innerHTML = '';
            
            state.imageList.forEach((image, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>${image.name}</span>
                        <span style="font-size: 12px; color: #666;">
                            ${formatFileSize(image.size)}
                        </span>
                    </div>
                `;
                
                fileItem.addEventListener('click', () => {
                    showImageByIndex(index);
                });
                
                elements.fileList.appendChild(fileItem);
            });
            
            elements.fileListContainer.style.display = 'block';
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(isLoading) {
            state.isLoading = isLoading;
            elements.randomBtn.disabled = isLoading;
            elements.prevBtn.disabled = isLoading;
            
            if (isLoading) {
                elements.loading.style.display = 'block';
                elements.image.style.display = 'none';
            }
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            elements.container.innerHTML = `
                <div style="text-align: center; color: #e74c3c; padding: 40px;">
                    <div style="font-size: 48px;">âŒ</div>
                    <h3>å‡ºé”™äº†</h3>
                    <p>${message}</p>
                    <button onclick="location.reload()" style="padding: 10px 20px; margin-top: 20px;">
                        é‡æ–°åŠ è½½
                    </button>
                </div>
            `;
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === undefined) return 'æœªçŸ¥å¤§å°';
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // éšæœºæŒ‰é’®
            elements.randomBtn.addEventListener('click', showRandomImage);
            
            // ä¸Šä¸€å¼ æŒ‰é’®
            elements.prevBtn.addEventListener('click', showPreviousImage);
            
            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                switch(e.key) {
                    case ' ':
                    case 'Enter':
                        e.preventDefault();
                        showRandomImage();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        showPreviousImage();
                        break;
                    case 'r':
                    case 'R':
                        if (e.ctrlKey) {
                            e.preventDefault();
                            init();
                        }
                        break;
                }
            });
            
            // é˜²æ­¢ç©ºæ ¼é”®æ»šåŠ¨é¡µé¢
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space' && e.target === document.body) {
                    e.preventDefault();
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
